<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jeopardy! Game Creator</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
      font-family: 'Bebas Neue', Impact, sans-serif;
      color: #fff;
    }

    /* Home View Styles */
    .home-wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 60px 20px;
    }

    .logo-section {
      text-align: center;
      margin-bottom: 50px;
      position: relative;
    }

    .logo-accent {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 8px;
      background: linear-gradient(90deg, transparent, #FFD700, transparent);
      border-radius: 4px;
    }

    .main-title {
      font-size: 72px;
      font-weight: 400;
      letter-spacing: 8px;
      color: #FFD700;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 4px 0 #B8860B;
      margin: 0;
    }

    .subtitle {
      font-size: 24px;
      color: #8888aa;
      letter-spacing: 12px;
      text-transform: uppercase;
      margin: 10px 0 0 0;
    }

    .create-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 24px 40px;
      font-size: 24px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 3px solid #3366cc;
      border-radius: 8px;
      color: #FFD700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(51, 102, 204, 0.3);
    }

    .create-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(51, 102, 204, 0.5);
    }

    .create-icon {
      font-size: 32px;
      font-weight: bold;
    }

    .games-section {
      margin-top: 50px;
    }

    .section-title {
      font-size: 28px;
      color: #8888aa;
      letter-spacing: 4px;
      margin-bottom: 20px;
    }

    .games-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .game-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: rgba(26, 58, 138, 0.3);
      border: 2px solid #3366cc;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .game-card:hover {
      background: rgba(26, 58, 138, 0.5);
    }

    .game-card-content {
      flex: 1;
    }

    .game-title {
      font-size: 22px;
      color: #fff;
      margin: 0 0 4px 0;
      letter-spacing: 2px;
    }

    .game-date {
      font-size: 14px;
      color: #6666aa;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    .game-actions {
      display: flex;
      gap: 10px;
    }

    .play-btn {
      padding: 10px 20px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 2px solid #32CD32;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .edit-btn {
      padding: 10px 20px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 2px solid #3366cc;
      border-radius: 4px;
      color: #FFD700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .delete-btn {
      padding: 10px 14px;
      font-size: 16px;
      background: rgba(139, 0, 0, 0.5);
      border: 2px solid #8B0000;
      border-radius: 4px;
      color: #FF6B6B;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    /* Edit View Styles */
    #edit-view, #play-view {
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .edit-header, .play-header {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.5);
      border-bottom: 2px solid #3366cc;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .back-button {
      padding: 8px 15px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: transparent;
      border: 2px solid #666;
      border-radius: 4px;
      color: #aaa;
      cursor: pointer;
      white-space: nowrap;
    }

    .title-input {
      flex: 1;
      min-width: 150px;
      padding: 10px 15px;
      font-size: 20px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #3366cc;
      border-radius: 4px;
      color: #FFD700;
      outline: none;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .save-button {
      padding: 10px 18px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 2px solid #32CD32;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .save-button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .save-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .save-success {
      color: #90EE90;
      font-weight: bold;
    }

    .preview-button {
      padding: 10px 18px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 2px solid #3366cc;
      border-radius: 4px;
      color: #FFD700;
      cursor: pointer;
      white-space: nowrap;
    }

    .board-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 15px 20px;
      overflow: hidden;
    }

    .board {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .category-row, .question-row {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }

    .category-row {
      flex: 0 0 auto;
    }

    .question-row {
      flex: 1;
      min-height: 0;
    }

    .category-input {
      flex: 1;
      min-width: 0;
      padding: 12px 8px;
      font-size: clamp(12px, 1.5vw, 18px);
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      text-align: center;
      background: linear-gradient(180deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 3px solid #3366cc;
      border-radius: 4px;
      color: #fff;
      outline: none;
      text-transform: uppercase;
    }

    .category-header {
      flex: 1;
      min-width: 0;
      padding: 12px 8px;
      font-size: clamp(12px, 1.5vw, 18px);
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      text-align: center;
      background: linear-gradient(180deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 3px solid #3366cc;
      border-radius: 4px;
      color: #fff;
      text-transform: uppercase;
      word-wrap: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .edit-cell {
      flex: 1;
      min-width: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 3px solid #3366cc;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .edit-cell:hover {
      border-color: #FFD700;
    }

    .edit-cell.filled {
      background: linear-gradient(180deg, #2a4a9a 0%, #1a2a5a 100%);
      border-color: #4488ee;
    }

    .cell-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .cell-points {
      font-size: clamp(18px, 2.5vw, 28px);
      color: #FFD700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .cell-check {
      font-size: 16px;
      color: #32CD32;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
    }

    .edit-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      max-width: 90%;
      padding: 20px;
      background: linear-gradient(180deg, #1a2a5a 0%, #0a1a3a 100%);
      border: 3px solid #FFD700;
      border-radius: 8px;
      z-index: 1001;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
    }

    .edit-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .edit-popup-points {
      font-size: 24px;
      color: #FFD700;
    }

    .close-edit-button {
      padding: 5px 10px;
      font-size: 18px;
      background: transparent;
      border: 1px solid #666;
      border-radius: 4px;
      color: #aaa;
      cursor: pointer;
    }

    .question-textarea, .answer-textarea {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      font-family: system-ui, sans-serif;
      background: rgba(255,255,255,0.1);
      border: 2px solid #3366cc;
      border-radius: 4px;
      color: #fff;
      resize: vertical;
      min-height: 80px;
      margin-bottom: 10px;
      outline: none;
    }

    .answer-textarea {
      background: rgba(50, 205, 50, 0.1);
      border-color: #32CD32;
      color: #90EE90;
      min-height: 60px;
    }

    .image-section {
      margin-top: 10px;
    }

    .upload-label {
      display: inline-block;
      padding: 10px 20px;
      font-size: 14px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      background: rgba(255,255,255,0.1);
      border: 2px dashed #666;
      border-radius: 4px;
      color: #aaa;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .upload-label:hover {
      border-color: #FFD700;
      color: #FFD700;
    }

    .image-preview-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .image-preview {
      max-width: 100%;
      max-height: 150px;
      object-fit: contain;
      border-radius: 4px;
    }

    .remove-image-button {
      padding: 8px 16px;
      font-size: 12px;
      font-family: system-ui, sans-serif;
      background: rgba(139, 0, 0, 0.5);
      border: 1px solid #8B0000;
      border-radius: 4px;
      color: #FF6B6B;
      cursor: pointer;
    }

    /* Play View Styles */
    .play-header {
      flex-direction: column;
      align-items: stretch;
      padding: 10px 20px;
    }

    .play-header-top {
      display: flex;
      align-items: center;
      gap: 15px;
      width: 100%;
    }

    .play-title {
      flex: 1;
      font-size: clamp(20px, 3vw, 32px);
      letter-spacing: 4px;
      color: #FFD700;
      text-align: center;
      margin: 0;
    }

    .teams-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .team-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      padding: 8px 15px;
      background: rgba(26, 58, 138, 0.5);
      border: 2px solid #3366cc;
      border-radius: 8px;
      position: relative;
      min-width: 100px;
    }

    .team-name-input {
      padding: 3px 8px;
      font-size: 14px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      text-align: center;
      background: transparent;
      border: none;
      border-bottom: 1px solid #666;
      color: #fff;
      outline: none;
      width: auto;
      min-width: 80px;
      max-width: 200px;
    }

    .team-name-display {
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      text-align: center;
      color: #fff;
      padding: 3px 8px;
    }

    .team-score {
      font-size: 22px;
      font-weight: bold;
    }

    .team-score.positive {
      color: #FFD700;
    }

    .team-score.negative {
      color: #FF6B6B;
    }

    .remove-team-button {
      position: absolute;
      top: 5px;
      right: 5px;
      padding: 2px 6px;
      font-size: 12px;
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
    }

    .add-team-button {
      padding: 8px 15px;
      font-size: 14px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      background: transparent;
      border: 2px dashed #666;
      border-radius: 8px;
      color: #888;
      cursor: pointer;
    }

    .play-cell {
      flex: 1;
      min-width: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 3px solid #3366cc;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .play-cell:hover:not(.answered):not(.empty) {
      transform: scale(1.02);
      border-color: #FFD700;
    }

    .play-cell.answered, .play-cell.empty {
      background: rgba(10, 26, 74, 0.3);
      border-color: rgba(51, 102, 204, 0.3);
      cursor: default;
    }

    .play-cell-points {
      font-size: clamp(20px, 3vw, 36px);
      color: #FFD700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 2000;
    }

    .question-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      max-width: 80vw;
      height: 90vh;
      padding: 40px;
      background: linear-gradient(180deg, #1a3a8a 0%, #0a1a4a 100%);
      border: 4px solid #3366cc;
      border-radius: 12px;
      z-index: 2001;
      box-shadow: 0 0 60px rgba(51, 102, 204, 0.5);
      text-align: center;
    }

    .modal-points {
      font-size: 48px;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      margin-bottom: 30px;
    }

    .question-image {
      max-width: 100%;
      max-height: 60vh;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 2px solid #3366cc;
    }

    .question-text {
      font-size: 28px;
      font-family: system-ui, sans-serif;
      color: #fff;
      line-height: 1.4;
      margin-bottom: 30px;
      text-transform: sentence-case;
    }

    .show-answer-button {
      padding: 16px 40px;
      font-size: 22px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 3px solid #32CD32;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(50, 205, 50, 0.3);
    }

    .scoring-section {
      margin-top: 20px;
    }

    .scoring-prompt {
      font-size: 18px;
      color: #aaa;
      margin-bottom: 15px;
      font-family: system-ui, sans-serif;
    }

    .team-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .team-score-button {
      padding: 14px 28px;
      font-size: 18px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 2px solid #32CD32;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
    }

    .no-one-button {
      padding: 12px 24px;
      font-size: 16px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: rgba(139, 0, 0, 0.5);
      border: 2px solid #8B0000;
      border-radius: 6px;
      color: #FF6B6B;
      cursor: pointer;
    }

    .close-modal-button {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 8px 14px;
      font-size: 20px;
      background: transparent;
      border: 2px solid #666;
      border-radius: 4px;
      color: #aaa;
      cursor: pointer;
    }

    .hidden {
      display: none !important;
    }

    /* Team Setup View Styles */
    #team-setup-view {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .setup-wrapper {
      width: 100%;
      max-width: 500px;
      padding: 20px;
    }

    .setup-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .setup-title {
      flex: 1;
      font-size: 36px;
      letter-spacing: 4px;
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
      margin: 0;
    }

    .setup-content {
      background: rgba(26, 58, 138, 0.3);
      border: 2px solid #3366cc;
      border-radius: 12px;
      padding: 30px;
    }

    .setup-subtitle {
      font-size: 16px;
      color: #8888aa;
      font-family: system-ui, sans-serif;
      margin: 0 0 25px 0;
      text-align: center;
    }

    .setup-teams-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .setup-team-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      background: rgba(10, 26, 74, 0.5);
      border: 2px solid #3366cc;
      border-radius: 8px;
    }

    .setup-team-number {
      font-size: 18px;
      color: #FFD700;
      min-width: 30px;
    }

    .setup-team-input {
      flex: 1;
      padding: 10px 15px;
      font-size: 18px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 1px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #4466aa;
      border-radius: 4px;
      color: #fff;
      outline: none;
    }

    .setup-team-input:focus {
      border-color: #FFD700;
    }

    .remove-setup-team-button {
      padding: 8px 12px;
      font-size: 16px;
      background: rgba(139, 0, 0, 0.5);
      border: 2px solid #8B0000;
      border-radius: 4px;
      color: #FF6B6B;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .remove-setup-team-button:hover {
      background: rgba(139, 0, 0, 0.8);
    }

    .add-team-setup-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 14px 20px;
      font-size: 18px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      background: transparent;
      border: 2px dashed #666;
      border-radius: 8px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 20px;
    }

    .add-team-setup-button:hover {
      border-color: #FFD700;
      color: #FFD700;
    }

    .start-game-button {
      width: 100%;
      padding: 18px 40px;
      font-size: 24px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 3px solid #32CD32;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(50, 205, 50, 0.3);
      transition: all 0.2s ease;
    }

    .start-game-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(50, 205, 50, 0.5);
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 30px;
      background: linear-gradient(135deg, #228B22 0%, #006400 100%);
      border: 2px solid #32CD32;
      border-radius: 8px;
      color: #fff;
      font-family: 'Bebas Neue', Impact, sans-serif;
      letter-spacing: 2px;
      font-size: 18px;
      z-index: 3000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <!-- Home View -->
  <div id="home-view">
    <div class="home-wrapper">
      <div class="logo-section">
        <div class="logo-accent"></div>
        <h1 class="main-title">JEOPARDY!</h1>
        <p class="subtitle">Game Creator</p>
      </div>
      
      <button class="create-button" onclick="createNewGame()">
        <span class="create-icon">+</span>
        Create New Game
      </button>

      <div id="games-section" class="games-section hidden">
        <h2 class="section-title">Your Games</h2>
        <div id="games-list" class="games-list"></div>
      </div>
    </div>
  </div>

  <!-- Team Setup View -->
  <div id="team-setup-view" class="hidden">
    <div class="setup-wrapper">
      <div class="setup-header">
        <button class="back-button" onclick="goHome()">‚Üê Back</button>
        <h1 class="setup-title">Team Setup</h1>
      </div>
      <div class="setup-content">
        <p class="setup-subtitle">Configure your teams before starting the game</p>
        
        <div id="setup-teams-list" class="setup-teams-list"></div>
        
        <button class="add-team-setup-button" onclick="addTeamInSetup()">
          <span class="create-icon">+</span> Add Team
        </button>
        
        <button class="start-game-button" onclick="startGame()">
          ‚ñ∂ Start Game
        </button>
      </div>
    </div>
  </div>

  <!-- Edit View -->
  <div id="edit-view" class="hidden">
    <div class="edit-header">
      <button class="back-button" onclick="goHome()">‚Üê Back</button>
      <input type="text" id="game-title-input" class="title-input" placeholder="Game Title">
      <div class="header-actions">
        <button class="save-button" onclick="saveCurrentGame()">
          <span id="save-icon-default">üíæ</span>
          <span id="save-icon-loading" class="hidden save-spinner"></span>
          <span id="save-icon-success" class="hidden">‚úì</span>
          <span id="save-text">Save Game</span>
        </button>
        <button class="preview-button" onclick="playCurrentGame()">‚ñ∂ Play</button>
      </div>
    </div>
    <div class="board-container">
      <div id="edit-board" class="board"></div>
    </div>
  </div>

  <!-- Play View -->
  <div id="play-view" class="hidden">
    <div class="play-header">
      <div class="play-header-top">
        <button class="back-button" onclick="goHome()">‚Üê Exit Game</button>
        <h1 id="play-title" class="play-title"></h1>
        <div style="width: 100px;"></div>
      </div>
      <div id="teams-container" class="teams-container"></div>
    </div>
    <div class="board-container">
      <div id="play-board" class="board"></div>
    </div>
  </div>

  <!-- Edit Popup -->
  <div id="edit-overlay" class="overlay hidden" onclick="closeEditPopup()"></div>
  <div id="edit-popup" class="edit-popup hidden">
    <div class="edit-popup-header">
      <span id="edit-popup-points" class="edit-popup-points"></span>
      <button class="close-edit-button" onclick="closeEditPopup()">‚úï</button>
    </div>
    <textarea id="question-input" class="question-textarea" placeholder="Enter the question/clue..."></textarea>
    <textarea id="answer-input" class="answer-textarea" placeholder="Enter the answer..."></textarea>
    <div class="image-section">
      <div id="image-preview-container" class="image-preview-container hidden">
        <img id="image-preview" class="image-preview" src="" alt="Question image">
        <button class="remove-image-button" onclick="removeImage()">Remove Image</button>
      </div>
      <label id="upload-label" class="upload-label">
        <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
        üì∑ Add Image
      </label>
    </div>
  </div>

  <!-- Question Modal -->
  <div id="modal-overlay" class="modal-overlay hidden" onclick="closeQuestionModal()"></div>
  <div id="question-modal" class="question-modal hidden">
    <div id="modal-points" class="modal-points"></div>
    <img id="modal-image" class="question-image hidden" src="" alt="Question image">
    <div id="modal-question-text" class="question-text"></div>
    <button id="show-answer-btn" class="show-answer-button" onclick="showAnswer()">Show Answer</button>
    <div id="scoring-section" class="scoring-section hidden">
      <p class="scoring-prompt">Who got it right?</p>
      <div id="team-buttons" class="team-buttons"></div>
      <button class="no-one-button" onclick="markAnswered(false, null)">No one got it</button>
    </div>
    <button class="close-modal-button" onclick="closeQuestionModal()">‚úï</button>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast">Game saved!</div>

  <script>
    const POINT_VALUES = [100, 200, 300, 400, 500];
    const DEFAULT_CATEGORIES = 5;

    let games = [];
    let currentGame = null;
    let editingCell = null;
    let selectedCell = null;
    let teams = [
      { name: 'Team 1', score: 0 },
      { name: 'Team 2', score: 0 }
    ];

    // Initialize
    document.addEventListener('DOMContentLoaded', loadGames);

    // Keyboard controls for question modal
    document.addEventListener('keydown', function(e) {
    // Only handle keys when modal is open
    const modal = document.getElementById('question-modal');
    if (modal.classList.contains('hidden')) return;
    
    // Spacebar to reveal answer
    if (e.code === 'Space') {
        e.preventDefault();
        const showAnswerBtn = document.getElementById('show-answer-btn');
        if (!showAnswerBtn.classList.contains('hidden')) {
        showAnswer();
        }
    }
    
    // Escape to close modal
    if (e.code === 'Escape') {
        closeQuestionModal();
    }
    });

    function createEmptyGame(title = 'Untitled Game') {
      return {
        id: Date.now().toString(),
        title,
        createdAt: new Date().toISOString(),
        categories: Array(DEFAULT_CATEGORIES).fill(null).map((_, i) => ({
          name: `Category ${i + 1}`,
          questions: POINT_VALUES.map(points => ({
            points,
            question: '',
            answer: '',
            image: null,
            answered: false
          }))
        }))
      };
    }

    function loadGames() {
      const saved = localStorage.getItem('jeopardy-games');
      if (saved) {
        games = JSON.parse(saved);
        renderGamesList();
      }
    }

    function saveGames() {
      localStorage.setItem('jeopardy-games', JSON.stringify(games));
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function renderGamesList() {
      const section = document.getElementById('games-section');
      const list = document.getElementById('games-list');
      
      if (games.length === 0) {
        section.classList.add('hidden');
        return;
      }

      section.classList.remove('hidden');
      list.innerHTML = games.map(game => `
        <div class="game-card">
          <div class="game-card-content">
            <h3 class="game-title">${escapeHtml(game.title)}</h3>
            <p class="game-date">${new Date(game.createdAt).toLocaleDateString()}</p>
          </div>
          <div class="game-actions">
            <button class="play-btn" onclick="loadGame('${game.id}', 'play')">‚ñ∂ Play</button>
            <button class="edit-btn" onclick="loadGame('${game.id}', 'edit')">‚úé Edit</button>
            <button class="delete-btn" onclick="deleteGame('${game.id}')">‚úï</button>
          </div>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function createNewGame() {
      currentGame = createEmptyGame();
      showView('edit');
      renderEditBoard();
      document.getElementById('game-title-input').value = currentGame.title;
    }

    function loadGame(gameId, mode) {
      const game = games.find(g => g.id === gameId);
      if (!game) return;

      currentGame = JSON.parse(JSON.stringify(game));
      
      if (mode === 'play') {
        currentGame.categories.forEach(cat => {
          cat.questions.forEach(q => q.answered = false);
        });
        teams = [
          { name: 'Team 1', score: 0 },
          { name: 'Team 2', score: 0 }
        ];
        showView('team-setup');
        renderSetupTeams();
      } else {
        showView('edit');
        renderEditBoard();
        document.getElementById('game-title-input').value = currentGame.title;
      }
    }

    function playCurrentGame() {
      currentGame.categories.forEach(cat => {
        cat.questions.forEach(q => q.answered = false);
      });
      teams = [
        { name: 'Team 1', score: 0 },
        { name: 'Team 2', score: 0 }
      ];
      
      showView('team-setup');
      renderSetupTeams();
    }

    function deleteGame(gameId) {
      if (confirm('Are you sure you want to delete this game?')) {
        games = games.filter(g => g.id !== gameId);
        saveGames();
        renderGamesList();
      }
    }

    async function saveCurrentGame() {
      const saveButton = document.querySelector('.save-button');
      const iconDefault = document.getElementById('save-icon-default');
      const iconLoading = document.getElementById('save-icon-loading');
      const iconSuccess = document.getElementById('save-icon-success');
      const saveText = document.getElementById('save-text');
      
      // Show loading state
      saveButton.disabled = true;
      iconDefault.classList.add('hidden');
      iconLoading.classList.remove('hidden');
      iconSuccess.classList.add('hidden');
      saveText.textContent = 'Saving...';
      
      try {
        currentGame.title = document.getElementById('game-title-input').value || 'Untitled Game';
        
        const existingIndex = games.findIndex(g => g.id === currentGame.id);
        if (existingIndex >= 0) {
          games[existingIndex] = currentGame;
        } else {
          games.push(currentGame);
        }
        
        // Simulate a small delay to ensure save completes
        await new Promise(resolve => setTimeout(resolve, 300));
        saveGames();
        
        // Show success state
        iconLoading.classList.add('hidden');
        iconSuccess.classList.remove('hidden');
        saveText.textContent = 'Saved!';
        
        // Reset to default after 2 seconds
        setTimeout(() => {
          iconSuccess.classList.add('hidden');
          iconDefault.classList.remove('hidden');
          saveText.textContent = 'Save Game';
          saveButton.disabled = false;
        }, 2000);
        
      } catch (error) {
        console.error('Save failed:', error);
        // Show error state
        iconLoading.classList.add('hidden');
        iconDefault.classList.remove('hidden');
        saveText.textContent = 'Save Failed';
        saveButton.disabled = false;
        
        setTimeout(() => {
          saveText.textContent = 'Save Game';
        }, 2000);
      }
    }

    function goHome() {
      showView('home');
      renderGamesList();
    }

    function showView(view) {
      document.getElementById('home-view').classList.toggle('hidden', view !== 'home');
      document.getElementById('team-setup-view').classList.toggle('hidden', view !== 'team-setup');
      document.getElementById('edit-view').classList.toggle('hidden', view !== 'edit');
      document.getElementById('play-view').classList.toggle('hidden', view !== 'play');
    }

    // Edit Board
    function renderEditBoard() {
      const board = document.getElementById('edit-board');
      
      let html = '<div class="category-row">';
      currentGame.categories.forEach((cat, catIndex) => {
        html += `<input type="text" class="category-input" value="${escapeHtml(cat.name)}" 
                  onchange="updateCategory(${catIndex}, this.value)" placeholder="Category ${catIndex + 1}">`;
      });
      html += '</div>';

      POINT_VALUES.forEach((points, qIndex) => {
        html += '<div class="question-row">';
        currentGame.categories.forEach((cat, catIndex) => {
          const question = cat.questions[qIndex];
          const hasContent = question.question || question.image;
          html += `
            <div class="edit-cell ${hasContent ? 'filled' : ''}" onclick="openEditPopup(${catIndex}, ${qIndex})">
              <div class="cell-preview">
                <span class="cell-points">$${points}</span>
                ${hasContent ? '<span class="cell-check">‚úì</span>' : ''}
              </div>
            </div>
          `;
        });
        html += '</div>';
      });

      board.innerHTML = html;
    }

    function updateCategory(catIndex, name) {
      currentGame.categories[catIndex].name = name;
    }

    function openEditPopup(catIndex, qIndex) {
      editingCell = { catIndex, qIndex };
      const question = currentGame.categories[catIndex].questions[qIndex];
      
      document.getElementById('edit-popup-points').textContent = `$${question.points}`;
      document.getElementById('question-input').value = question.question;
      document.getElementById('answer-input').value = question.answer;
      
      if (question.image) {
        document.getElementById('image-preview').src = question.image;
        document.getElementById('image-preview-container').classList.remove('hidden');
        document.getElementById('upload-label').classList.add('hidden');
      } else {
        document.getElementById('image-preview-container').classList.add('hidden');
        document.getElementById('upload-label').classList.remove('hidden');
      }

      document.getElementById('edit-overlay').classList.remove('hidden');
      document.getElementById('edit-popup').classList.remove('hidden');
    }

    function closeEditPopup() {
      if (editingCell) {
        const question = currentGame.categories[editingCell.catIndex].questions[editingCell.qIndex];
        question.question = document.getElementById('question-input').value;
        question.answer = document.getElementById('answer-input').value;
        renderEditBoard();
      }
      
      editingCell = null;
      document.getElementById('edit-overlay').classList.add('hidden');
      document.getElementById('edit-popup').classList.add('hidden');
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file && editingCell) {
        const reader = new FileReader();
        reader.onloadend = () => {
          currentGame.categories[editingCell.catIndex].questions[editingCell.qIndex].image = reader.result;
          document.getElementById('image-preview').src = reader.result;
          document.getElementById('image-preview-container').classList.remove('hidden');
          document.getElementById('upload-label').classList.add('hidden');
        };
        reader.readAsDataURL(file);
      }
      event.target.value = '';
    }

    function removeImage() {
      if (editingCell) {
        currentGame.categories[editingCell.catIndex].questions[editingCell.qIndex].image = null;
        document.getElementById('image-preview-container').classList.add('hidden');
        document.getElementById('upload-label').classList.remove('hidden');
      }
    }

    // Play Board
    function renderPlayBoard() {
      const board = document.getElementById('play-board');
      
      let html = '<div class="category-row">';
      currentGame.categories.forEach(cat => {
        html += `<div class="category-header">${escapeHtml(cat.name)}</div>`;
      });
      html += '</div>';

      POINT_VALUES.forEach((points, qIndex) => {
        html += '<div class="question-row">';
        currentGame.categories.forEach((cat, catIndex) => {
          const question = cat.questions[qIndex];
          const isAnswered = question.answered;
          const hasContent = question.question;
          
          html += `
            <div class="play-cell ${isAnswered ? 'answered' : ''} ${!hasContent ? 'empty' : ''}" 
                 onclick="selectQuestion(${catIndex}, ${qIndex})">
              ${!isAnswered && hasContent ? `<span class="play-cell-points">$${points}</span>` : ''}
            </div>
          `;
        });
        html += '</div>';
      });

      board.innerHTML = html;
    }

    function renderTeams() {
      const container = document.getElementById('teams-container');
      
      let html = teams.map((team, index) => `
        <div class="team-card">
          <div class="team-name-display">${escapeHtml(team.name)}</div>
          <div class="team-score ${team.score >= 0 ? 'positive' : 'negative'}">
            $${team.score.toLocaleString()}
          </div>
        </div>
      `).join('');
      
      container.innerHTML = html;
    }

    function updateTeamName(index, name) {
      teams[index].name = name;
    }

    function autoResizeInput(input) {
      // Create a temporary span to measure text width
      const span = document.createElement('span');
      span.style.visibility = 'hidden';
      span.style.position = 'absolute';
      span.style.whiteSpace = 'pre';
      span.style.font = window.getComputedStyle(input).font;
      span.style.letterSpacing = window.getComputedStyle(input).letterSpacing;
      span.textContent = input.value || input.placeholder || '';
      document.body.appendChild(span);
      
      const textWidth = span.offsetWidth + 20; // Add padding
      document.body.removeChild(span);
      
      const minWidth = 80;
      const maxWidth = 200;
      input.style.width = Math.min(Math.max(textWidth, minWidth), maxWidth) + 'px';
    }

    function addTeam() {
      teams.push({ name: `Team ${teams.length + 1}`, score: 0 });
      renderTeams();
    }

    // Team Setup Functions
    function renderSetupTeams() {
      const list = document.getElementById('setup-teams-list');
      
      list.innerHTML = teams.map((team, index) => `
        <div class="setup-team-row">
          <span class="setup-team-number">${index + 1}.</span>
          <input type="text" class="setup-team-input" value="${escapeHtml(team.name)}" 
                 onchange="updateSetupTeamName(${index}, this.value)"
                 placeholder="Enter team name">
          ${teams.length > 1 ? `<button class="remove-setup-team-button" onclick="removeTeamInSetup(${index})">‚úï</button>` : ''}
        </div>
      `).join('');
    }

    function updateSetupTeamName(index, name) {
      teams[index].name = name;
    }

    function addTeamInSetup() {
      teams.push({ name: `Team ${teams.length + 1}`, score: 0 });
      renderSetupTeams();
    }

    function removeTeamInSetup(index) {
      if (teams.length > 1) {
        teams.splice(index, 1);
        renderSetupTeams();
      }
    }

    function startGame() {
      showView('play');
      renderPlayBoard();
      renderTeams();
      document.getElementById('play-title').textContent = currentGame.title;
    }

    function removeTeam(index) {
      if (teams.length > 1) {
        teams.splice(index, 1);
        renderTeams();
      }
    }

    function selectQuestion(catIndex, qIndex) {
      const question = currentGame.categories[catIndex].questions[qIndex];
      if (question.answered || !question.question) return;

      selectedCell = { catIndex, qIndex };
      
      document.getElementById('modal-points').textContent = `$${question.points}`;
      document.getElementById('modal-question-text').textContent = question.question;
      
      if (question.image) {
        document.getElementById('modal-image').src = question.image;
        document.getElementById('modal-image').classList.remove('hidden');
      } else {
        document.getElementById('modal-image').classList.add('hidden');
      }

      document.getElementById('show-answer-btn').classList.remove('hidden');
      document.getElementById('scoring-section').classList.add('hidden');

      document.getElementById('modal-overlay').classList.remove('hidden');
      document.getElementById('question-modal').classList.remove('hidden');
    }

    function showAnswer() {
      const question = currentGame.categories[selectedCell.catIndex].questions[selectedCell.qIndex];
      document.getElementById('modal-question-text').textContent = question.answer;
      document.getElementById('modal-image').classList.add('hidden');
      document.getElementById('show-answer-btn').classList.add('hidden');
      
      // Render team buttons
      const teamButtons = document.getElementById('team-buttons');
      teamButtons.innerHTML = teams.map((team, index) => `
        <button class="team-score-button" onclick="markAnswered(true, ${index})">
          ${escapeHtml(team.name)} +$${question.points}
        </button>
      `).join('');
      
      document.getElementById('scoring-section').classList.remove('hidden');
    }

    function markAnswered(correct, teamIndex) {
      if (selectedCell && teamIndex !== null) {
        const points = currentGame.categories[selectedCell.catIndex].questions[selectedCell.qIndex].points;
        teams[teamIndex].score += correct ? points : -points;
      }
      
      currentGame.categories[selectedCell.catIndex].questions[selectedCell.qIndex].answered = true;
      
      closeQuestionModal();
      renderPlayBoard();
      renderTeams();
    }

    function closeQuestionModal() {
      selectedCell = null;
      document.getElementById('modal-overlay').classList.add('hidden');
      document.getElementById('question-modal').classList.add('hidden');
    }
  </script>
</body>
</html>